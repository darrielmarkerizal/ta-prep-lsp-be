import { getRaw } from "@scalar/json-magic/magic-proxy";
const getResolvedRefDeep = (node) => {
  const visited = /* @__PURE__ */ new WeakSet();
  const resolveNode = (current) => {
    if (current === null || current === void 0 || typeof current !== "object") {
      return current;
    }
    const raw = getRaw(current);
    if (visited.has(raw)) {
      return "[circular]";
    }
    visited.add(raw);
    if (typeof current === "object" && current !== null && "$ref" in current) {
      const refValue = current["$ref-value"];
      const resolved = resolveNode(refValue);
      visited.delete(raw);
      return resolved;
    }
    if (Array.isArray(current)) {
      const resolvedArray = current.map((item) => resolveNode(item));
      visited.delete(raw);
      return resolvedArray;
    }
    if (typeof current === "object" && current !== null) {
      const resolvedObject = {};
      for (const [key, value] of Object.entries(current)) {
        resolvedObject[key] = resolveNode(value);
      }
      visited.delete(raw);
      return resolvedObject;
    }
    visited.delete(raw);
    return current;
  };
  return resolveNode(node);
};
export {
  getResolvedRefDeep
};
