import { onCustomEvent } from "@scalar/workspace-store/events";
const useLegacyStoreEvents = (store, legacyStore, activeEntities, root) => {
  const { servers, serverMutators, requestMutators, collectionMutators, securitySchemeMutators } = legacyStore;
  const { activeCollection, activeServer } = activeEntities;
  onCustomEvent(root, "scalar-replace-servers", ({ detail: { servers: inputServers, options } }) => {
    if (options?.disableOldStoreUpdate === true) {
      return;
    }
    const collection = activeCollection.value;
    if (!collection) {
      return console.warn("No active collection found");
    }
    collection.servers.forEach((serverUid) => {
      serverMutators.delete(serverUid, collection.uid);
    });
    inputServers.forEach((server) => {
      const result = Object.values(servers).find((s) => s.url === server.url);
      if (result) {
        serverMutators.add(result, collection.uid);
      }
    });
    const lastServer = Object.values(servers).find((s) => s.url === inputServers.at(-1)?.url);
    collectionMutators.edit(collection.uid, "selectedServerUid", lastServer?.uid);
  });
  onCustomEvent(root, "scalar-update-selected-server", ({ detail: { value, options } }) => {
    if (options?.disableOldStoreUpdate === true) {
      return;
    }
    const collection = activeCollection.value;
    if (!collection) {
      return;
    }
    const server = Object.values(servers).find((s) => s.url === value);
    if (!server) {
      return;
    }
    collectionMutators.edit(collection.uid, "selectedServerUid", server.uid);
  });
  onCustomEvent(root, "store-update-selected-server-properties", ({ detail: { key, value, options } }) => {
    if (options?.disableOldStoreUpdate) {
      return;
    }
    const server = activeServer.value;
    if (!server) {
      return;
    }
    serverMutators.edit(server.uid, key, value);
  });
  onCustomEvent(root, "scalar-update-selected-server-variables", ({ detail: { key, value, options } }) => {
    if (options?.disableOldStoreUpdate === true) {
      return;
    }
    const server = activeServer.value;
    if (!server || server.url !== store.workspace.activeDocument?.["x-scalar-active-server"]) {
      return;
    }
    const variables = server.variables || {};
    variables[key] = { ...variables[key], default: value };
    serverMutators.edit(server.uid, "variables", variables);
  });
  onCustomEvent(root, "scalar-select-security-schemes", ({ detail: { uids } }) => {
    const collection = activeCollection.value;
    if (!collection) {
      return console.warn("No active collection found");
    }
    collectionMutators.edit(collection.uid, "selectedSecuritySchemeUids", uids);
  });
  onCustomEvent(root, "scalar-select-operation-security-schemes", ({ detail: { operationUid, uids } }) => {
    requestMutators.edit(operationUid, "selectedSecuritySchemeUids", uids);
  });
  onCustomEvent(root, "scalar-edit-security-scheme", ({ detail: { uid, path, value } }) => {
    securitySchemeMutators.edit(uid, path, value);
  });
  onCustomEvent(root, "scalar-add-auth-option", ({ detail: { payload } }) => {
    const collection = activeCollection.value;
    if (!collection) {
      return console.warn("No active collection found");
    }
    securitySchemeMutators.add(payload, collection.uid);
  });
  onCustomEvent(root, "scalar-delete-security-scheme", ({ detail: { uid } }) => {
    const collection = activeCollection.value;
    if (!collection) {
      return console.warn("No active collection found");
    }
    securitySchemeMutators.delete(uid);
  });
};
export {
  useLegacyStoreEvents
};
