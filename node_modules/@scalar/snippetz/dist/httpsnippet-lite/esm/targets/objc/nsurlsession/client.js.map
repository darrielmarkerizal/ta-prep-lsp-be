{
  "version": 3,
  "sources": ["../../../../../../src/httpsnippet-lite/esm/targets/objc/nsurlsession/client.ts"],
  "sourcesContent": ["// @ts-nocheck\n/**\n * @description\n * HTTP code snippet generator for Objective-C using NSURLSession.\n *\n * @author\n * @thibaultCha\n *\n * for any questions or issues regarding the generated code snippet, please open an issue mentioning the author.\n */\nimport { CodeBuilder } from '../../../helpers/code-builder.js'\nimport { nsDeclaration } from '../helpers.js'\n\nexport const nsurlsession = {\n  info: {\n    key: 'nsurlsession',\n    title: 'NSURLSession',\n    link: 'https://developer.apple.com/library/mac/documentation/Foundation/Reference/NSURLSession_class/index.html',\n    description: \"Foundation's NSURLSession request\",\n  },\n  convert: ({ allHeaders, postData, method, fullUrl }, options) => {\n    let _a\n    const opts = {\n      indent: '    ',\n      pretty: true,\n      timeout: 10,\n      ...options,\n    }\n    const { push, join, blank } = new CodeBuilder({ indent: opts.indent })\n    // Markers for headers to be created as literal objects and later be set on the NSURLRequest if exist\n    const req = {\n      hasHeaders: false,\n      hasBody: false,\n    }\n    // We just want to make sure people understand that is the only dependency\n    push('#import <Foundation/Foundation.h>')\n    if (Object.keys(allHeaders).length) {\n      req.hasHeaders = true\n      blank()\n      push(nsDeclaration('NSDictionary', 'headers', allHeaders, opts.pretty))\n    }\n    if (postData && (postData.text || postData.jsonObj || postData.params)) {\n      req.hasBody = true\n      switch (postData.mimeType) {\n        case 'application/x-www-form-urlencoded':\n          if (\n            (_a = postData.params) === null || _a === void 0\n              ? void 0\n              : _a.length\n          ) {\n            // By appending parameters one by one in the resulting snippet,\n            // we make it easier for the user to edit it according to his or her needs after pasting.\n            // The user can just add/remove lines adding/removing body parameters.\n            blank()\n            const [head, ...tail] = postData.params\n            push(\n              `NSMutableData *postData = [[NSMutableData alloc] initWithData:[@\"${head.name}=${head.value}\" dataUsingEncoding:NSUTF8StringEncoding]];`,\n            )\n            tail.forEach(({ name, value }) => {\n              push(\n                `[postData appendData:[@\"&${name}=${value}\" dataUsingEncoding:NSUTF8StringEncoding]];`,\n              )\n            })\n          } else {\n            req.hasBody = false\n          }\n          break\n        case 'application/json':\n          if (postData.jsonObj) {\n            push(\n              nsDeclaration(\n                'NSDictionary',\n                'parameters',\n                postData.jsonObj,\n                opts.pretty,\n              ),\n            )\n            blank()\n            push(\n              'NSData *postData = [NSJSONSerialization dataWithJSONObject:parameters options:0 error:nil];',\n            )\n          }\n          break\n        case 'multipart/form-data':\n          // By appending multipart parameters one by one in the resulting snippet,\n          // we make it easier for the user to edit it according to his or her needs after pasting.\n          // The user can just edit the parameters NSDictionary or put this part of a snippet in a multipart builder method.\n          push(\n            nsDeclaration(\n              'NSArray',\n              'parameters',\n              postData.params || [],\n              opts.pretty,\n            ),\n          )\n          push(`NSString *boundary = @\"${postData.boundary}\";`)\n          blank()\n          push('NSError *error;')\n          push('NSMutableString *body = [NSMutableString string];')\n          push('for (NSDictionary *param in parameters) {')\n          push('[body appendFormat:@\"--%@\\\\r\\\\n\", boundary];', 1)\n          push('if (param[@\"fileName\"]) {', 1)\n          push(\n            '[body appendFormat:@\"Content-Disposition:form-data; name=\\\\\"%@\\\\\"; filename=\\\\\"%@\\\\\"\\\\r\\\\n\", param[@\"name\"], param[@\"fileName\"]];',\n            2,\n          )\n          push(\n            '[body appendFormat:@\"Content-Type: %@\\\\r\\\\n\\\\r\\\\n\", param[@\"contentType\"]];',\n            2,\n          )\n          push(\n            '[body appendFormat:@\"%@\", [NSString stringWithContentsOfFile:param[@\"fileName\"] encoding:NSUTF8StringEncoding error:&error]];',\n            2,\n          )\n          push('if (error) {', 2)\n          push('NSLog(@\"%@\", error);', 3)\n          push('}', 2)\n          push('} else {', 1)\n          push(\n            '[body appendFormat:@\"Content-Disposition:form-data; name=\\\\\"%@\\\\\"\\\\r\\\\n\\\\r\\\\n\", param[@\"name\"]];',\n            2,\n          )\n          push('[body appendFormat:@\"%@\", param[@\"value\"]];', 2)\n          push('}', 1)\n          push('}')\n          push('[body appendFormat:@\"\\\\r\\\\n--%@--\\\\r\\\\n\", boundary];')\n          push(\n            'NSData *postData = [body dataUsingEncoding:NSUTF8StringEncoding];',\n          )\n          break\n        default:\n          blank()\n          push(\n            `NSData *postData = [[NSData alloc] initWithData:[@\"${postData.text}\" dataUsingEncoding:NSUTF8StringEncoding]];`,\n          )\n      }\n    }\n    blank()\n    push(\n      `NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@\"${fullUrl}\"]`,\n    )\n    // NSURLRequestUseProtocolCachePolicy is the default policy, let's just always set it to avoid confusion.\n    push(\n      '                                                       cachePolicy:NSURLRequestUseProtocolCachePolicy',\n    )\n    push(\n      `                                                   timeoutInterval:${opts.timeout.toFixed(1)}];`,\n    )\n    push(`[request setHTTPMethod:@\"${method}\"];`)\n    if (req.hasHeaders) {\n      push('[request setAllHTTPHeaderFields:headers];')\n    }\n    if (req.hasBody) {\n      push('[request setHTTPBody:postData];')\n    }\n    blank()\n    // Retrieving the shared session will be less verbose than creating a new one.\n    push('NSURLSession *session = [NSURLSession sharedSession];')\n    push(\n      'NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request',\n    )\n    push(\n      '                                            completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {',\n    )\n    push('                                            if (error) {', 1)\n    push('                                            NSLog(@\"%@\", error);', 2)\n    push('                                            } else {', 1)\n    // Casting the NSURLResponse to NSHTTPURLResponse so the user can see the status     .\n    push(\n      '                                            NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;',\n      2,\n    )\n    push(\n      '                                            NSLog(@\"%@\", httpResponse);',\n      2,\n    )\n    push('                                            }', 1)\n    push('                                            }];')\n    push('[dataTask resume];')\n    return join()\n  },\n}\n"],
  "mappings": "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",
  "names": []
}
