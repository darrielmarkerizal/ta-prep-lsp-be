import { defineComponent as E, ref as u, computed as d, onMounted as N, createBlock as x, createCommentVNode as P, openBlock as r, unref as f, withCtx as y, createElementVNode as s, normalizeStyle as b, createElementBlock as p, Fragment as _, renderList as q, normalizeClass as A, createTextVNode as w, toDisplayString as g, createVNode as T } from "vue";
import { ScalarTeleport as j, ScalarButton as D } from "@scalar/components";
import { ScalarIconPlus as F } from "@scalar/icons";
import { onClickOutside as I } from "@vueuse/core";
import K from "fuse.js";
const O = {
  key: 0,
  class: "gap-1/2 flex flex-col"
}, R = ["onClick"], L = { class: "flex items-center gap-2 whitespace-nowrap" }, M = { class: "w-20 overflow-hidden text-right text-ellipsis whitespace-nowrap" }, Y = /* @__PURE__ */ E({
  __name: "EnvironmentVariablesDropdown",
  props: {
    query: {},
    environment: {},
    dropdownPosition: {}
  },
  emits: ["select", "redirect"],
  setup(n, { expose: k, emit: V }) {
    const m = V, i = u(!0), c = u(null), o = u(0), C = () => {
      m("redirect"), i.value = !1;
    }, v = d(
      () => n.environment.variables.map((e) => ({
        key: e.name,
        value: typeof e.value == "string" ? e.value : e.value.default
      }))
    ), S = new K(v.value, {
      keys: ["key", "value"]
    }), a = d(() => {
      if (!n.query)
        return v.value.slice(-4).filter(({ key: t, value: l }) => t !== "" || l !== "");
      const e = S.search(n.query, { limit: 10 });
      return e.length > 0 ? e.map((t) => t.item).filter(({ key: t, value: l }) => t !== "" || l !== "") : [];
    }), h = (e) => {
      m("select", e);
    };
    k({
      handleArrowKey: (e) => {
        const t = e === "up" ? -1 : 1, l = a.value.length;
        l !== 0 && (o.value = (o.value + t + l) % l);
      },
      handleSelect: () => {
        if (o.value >= 0) {
          const e = a.value[o.value];
          e && h(e.key);
        }
      }
    }), N(() => {
      o.value = 0;
    });
    const z = d(() => ({
      left: (n.dropdownPosition?.left ?? 0) + "px",
      // Add a 5px offset from the editor
      top: (n.dropdownPosition?.top ?? 0) + 5 + "px"
    }));
    return I(
      c,
      () => {
        i.value = !1;
      },
      { ignore: [c] }
    ), (e, t) => i.value ? (r(), x(f(j), {
      key: 0,
      class: "scalar-client"
    }, {
      default: y(() => [
        s("div", {
          ref_key: "dropdownRef",
          ref: c,
          class: "custom-scroll fixed top-0 left-0 flex max-h-[60svh] w-56 flex-col rounded border p-0.75",
          style: b(z.value)
        }, [
          a.value.length ? (r(), p("ul", O, [
            (r(!0), p(_, null, q(a.value, (l, B) => (r(), p("li", {
              key: l.key,
              class: A(["font-code text-xxs hover:bg-b-2 flex h-8 cursor-pointer items-center justify-between gap-1.5 rounded p-1.5 transition-colors duration-150", { "bg-b-2": B === o.value }]),
              onClick: (H) => h(l.key)
            }, [
              s("div", L, [
                s("span", {
                  class: "h-2.25 w-2.25 min-w-2.25 rounded-full",
                  style: b({
                    backgroundColor: e.environment.color
                  })
                }, null, 4),
                w(" " + g(l.key), 1)
              ]),
              s("span", M, g(l.value), 1)
            ], 10, R))), 128))
          ])) : (r(), x(f(D), {
            key: 1,
            class: "font-code text-xxs bg-b-inherit hover:bg-b-2 flex h-8 w-full justify-start gap-2 px-1.5 transition-colors duration-150",
            variant: "outlined",
            onClick: C
          }, {
            default: y(() => [
              T(f(F), { class: "size-3" }),
              t[0] || (t[0] = w(" Add Variable ", -1))
            ]),
            _: 1
          })),
          t[1] || (t[1] = s("div", { class: "bg-b-1 brightness-lifted absolute inset-0 -z-1 rounded shadow-lg" }, null, -1))
        ], 4)
      ]),
      _: 1
    })) : P("", !0);
  }
});
export {
  Y as default
};
